
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>BOM Web Multi-Filtres</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  select { margin-right: 10px; min-width: 120px; }
  table { border-collapse: collapse; margin-top: 20px; width: 60%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f0f0f0; }
</style>
</head>
<body>

<h2>Calculateur de BOM</h2>

<label>Qualité:
<select id="filterQualite" multiple size="3">
  <option value="gold">Gold</option>
  <option value="vio">Vio</option>
  <option value="rouge">Rouge</option>
</select>
</label>

<label>Type:
<select id="filterType" multiple size="4">
  <option value="Armes">Armes</option>
  <option value="Armures">Armures</option>
  <option value="Capes">Capes</option>
  <option value="Accessoires">Accessoires</option>
</select>
</label>

<label>Niveau:
<select id="filterNiveau" multiple size="10">
  <option value="50">50</option>
  <option value="60">60</option>
  <option value="65">65</option>
  <option value="70">70</option>
  <option value="75">75</option>
  <option value="80">80</option>
  <option value="85">85</option>
  <option value="90">90</option>
  <option value="95">95</option>
  <option value="100">100</option>
</select>
</label>

<button onclick="calculerBOM()">Calculer BOM</button>
<button onclick="deselectionner()">Tout désélectionner</button>

<table id="resultTable">
  <thead>
    <tr>
      <th>Composant</th>
      <th>Quantité totale</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let items = [];

fetch('items.json')
  .then(response => response.json())
  .then(data => { items = data; })
  .catch(err => alert('Erreur de chargement du JSON : ' + err));

// Fonction pour récupérer toutes les valeurs sélectionnées d'un <select multiple>
function getSelectedOptions(selectId) {
  const select = document.getElementById(selectId);
  const values = [];
  for (const option of select.options) {
    if (option.selected) values.push(option.value);
  }
  return values;
}

function calculerBOM() {
  const qualites = getSelectedOptions('filterQualite');
  const types = getSelectedOptions('filterType');
  const niveaux = getSelectedOptions('filterNiveau');

  const resultats = {};

  items.forEach(item => {
    if ((qualites.length === 0 || qualites.includes(item.qualite)) &&
        (types.length === 0 || types.includes(item.type)) &&
        (niveaux.length === 0 || niveaux.includes(item.niveau))) {

      for (let i=1; i<=3; i++) {
        const compo = item['compo'+i];
        const qte = item['qte'+i];
        if (compo && compo.toUpperCase() !== "NULL") {
          if (resultats[compo]) resultats[compo] += Number(qte);
          else resultats[compo] = Number(qte);
        }
      }
    }
  });

  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML = '';

  for (const compo in resultats) {
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.textContent = compo;
    const tdQte = document.createElement('td');
    tdQte.textContent = resultats[compo];
    tr.appendChild(tdName);
    tr.appendChild(tdQte);
    tbody.appendChild(tr);
  }
}

function deselectionner() {
  ['filterQualite', 'filterType', 'filterNiveau'].forEach(id => {
    const select = document.getElementById(id);
    for (const option of select.options) option.selected = false;
  });
  document.querySelector('#resultTable tbody').innerHTML = '';
}
</script>

</body>
</html>
